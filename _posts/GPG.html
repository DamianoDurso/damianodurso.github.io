<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Gender Pay Gap Methods</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="GPG_files/libs/clipboard/clipboard.min.js"></script>
<script src="GPG_files/libs/quarto-html/quarto.js"></script>
<script src="GPG_files/libs/quarto-html/popper.min.js"></script>
<script src="GPG_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="GPG_files/libs/quarto-html/anchor.min.js"></script>
<link href="GPG_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="GPG_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="GPG_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="GPG_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="GPG_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Gender Pay Gap Methods</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="background-the-push-for-pay-transparency" class="level1">
<h1>Background: The Push for Pay Transparency</h1>
<p>In today’s workplace, Diversity, Equity, and Inclusion (<strong>DEI</strong>) go beyond just policies; they’re about <strong>ensuring everyone is treated and compensated fairly, regardless of gender, race, or any other protected characteristic</strong>. One area gaining a lot of attention is the gender pay gap (GPG), which shows differences in average pay between men and women. <strong>With recent directives like the upcoming EU pay transparency regulation, companies are increasingly required to report pay data</strong>, making GPG a critical topic for HR teams.</p>
<p>More companies are now reporting their GPG numbers, and with these new laws, most will soon be required to make these numbers public. Traditionally, this analysis might have been handled by finance teams, but as People Analytics grows in HR, data experts in HR are stepping in to help ensure accurate, meaningful GPG reporting. However, <strong>calculating and interpreting GPG can be challenging</strong>, as it involves many factors that require careful consideration.</p>
<p>In this post, <strong>we’ll cover key metrics that help HR teams assess GPG and discuss how certain analytical choices can impact the results</strong>. Plus, I’ll share some code to make implementing these calculations straightforward for your team.</p>
</section>
<section id="key-metrics-for-gender-pay-gap-reporting" class="level1">
<h1>Key Metrics for Gender Pay Gap Reporting</h1>
<p>When it comes to gender pay gap (GPG), two main metrics are often reported: the Unadjusted and Adjusted Gender Pay Gap.</p>
<ul>
<li><strong>Unadjusted Gender Pay Gap (UGPG)</strong>: This measures the difference in average pay between all male and female employees, presented as a percentage of average male pay. UGPG is a high-level metric, reflecting overall pay differences without considering job type, experience, or role.</li>
<li><strong>Adjusted Gender Pay Gap (AGPG)</strong>: This digs a bit deeper. AGPG adjusts for factors like role, experience, and other structural differences to provide a more direct comparison of pay between men and women in similar positions. It shows the difference in average pay when comparing employees in “comparable positions,” expressed as a percentage of average male pay.</li>
</ul>
<p>Determining an AGPG can be tricky, though, since <strong>deciding what qualifies as “comparable positions” and which factors should be “adjusted for” can vary between companies and contexts</strong>. Questions like <em>“What defines a comparable position?”</em> and <em>“How should we adjust for structural differences?”</em> are crucial to get accurate and meaningful GPG results.</p>
<p>In the following sections, I’ll <strong>break down these metrics step-by-step and include code examples you can use to start calculating GPG metrics in your organization</strong>.</p>
</section>
<section id="a-concrete-gpg-analysis-example" class="level1">
<h1>A concrete GPG analysis example</h1>
<section id="the-data" class="level2">
<h2 class="anchored" data-anchor-id="the-data">The Data</h2>
<p>For this post, I will be using the <a href="'https://www.kaggle.com/datasets/nilimajauhari/glassdoor-analyze-gender-pay-gap'">Glassdoor Gender Pay Gap data from Kaggle</a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">"Glassdoor Gender Pay Gap.csv"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df) ; <span class="fu">nrow</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             JobTitle Gender Age PerfEval Education           Dept Seniority
1    Graphic Designer Female  18        5   College     Operations         2
2   Software Engineer   Male  21        5   College     Management         5
3 Warehouse Associate Female  19        4       PhD Administration         5
4   Software Engineer   Male  20        5   Masters          Sales         4
5    Graphic Designer   Male  26        5   Masters    Engineering         5
6                  IT Female  20        5       PhD     Operations         4
  BasePay Bonus
1   42363  9938
2  108476 11128
3   90208  9268
4  108080 10154
5   99464  9319
6   70890 10126</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1000</code></pre>
</div>
</div>
<p>As we can see this data set contains 1000 individual records of salary, bonus, job title etc.</p>
</section>
</section>
<section id="data-exploration" class="level1">
<h1>Data Exploration</h1>
<p>Before diving into calculating the UGPG and AGPG, let’s have a look at the data characteristics broken down by gender.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="GPG_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="1152"></p>
</div>
</div>
<p>On the diagonal of this plot grid we can see the distributions for base pay age, performance, sentiority and education. On the off-grid plots, we can see the joint plots. What stands out is that there seems to be some gender differences in terms of Age, performance evaluation, seniority and education.</p>
<section id="unadjusted-gender-pay-gap" class="level2">
<h2 class="anchored" data-anchor-id="unadjusted-gender-pay-gap">Unadjusted Gender Pay Gap</h2>
<p>The first step in analyzing the GPG would be the average difference in pay between man and women, also called the Unadjusted Gender Pay gap. In our case we will be calculating this metric following the definition above which is <span class="math display">\[
\text{UGPG} = \frac{\text{Avg. male earnings} - \text{Avg. female earnings}}{\text{Avg. male earnings}} \times 100\%
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>avg_pay_men <span class="ot">=</span> <span class="fu">mean</span>(df[df[<span class="st">'Gender'</span>] <span class="sc">==</span> <span class="st">'Male'</span>, <span class="st">'BasePay'</span>])</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>avg_pay_women <span class="ot">=</span> <span class="fu">mean</span>(df[df[<span class="st">'Gender'</span>] <span class="sc">==</span> <span class="st">'Female'</span>, <span class="st">'BasePay'</span>])</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>GPG <span class="ot">=</span> <span class="fu">round</span>(((avg_pay_men<span class="sc">-</span>avg_pay_women)<span class="sc">/</span>avg_pay_men)<span class="sc">*</span><span class="dv">100</span>,<span class="dv">2</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">paste0</span>(<span class="st">"The Unadjusted Gender Pay Gap is = "</span>, <span class="sc">-</span><span class="dv">1</span><span class="sc">*</span>GPG, <span class="st">"%"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "The Unadjusted Gender Pay Gap is = -8.65%"</code></pre>
</div>
</div>
<p>As we can see, the UGPG seems to be -8.65% meaning that women earn, on average, 8.65% less than men. However, this metric is quite rough as it does not take into account other characteristics that may be relevant to someone’s pay, such as their job title, years of experience etc. For accounting for these characteristics we will, thus, calculate the adjusted GPG.</p>
</section>
</section>
<section id="adjusted-gpg" class="level1">
<h1>Adjusted GPG</h1>
<section id="oaxaca-blinder" class="level2">
<h2 class="anchored" data-anchor-id="oaxaca-blinder">Oaxaca Blinder</h2>
<p>A typical approach to calculate the AGPG is the Oaxaca-Blinder method. This approach is a statistical method used to decompose pay differences into explainable factors (differences in education or experience) and unexplainable factors (someone’s gender). This method allows for a clearer understanding of how much of the pay gap can be explained by measurable differences versus systemic inequalities.</p>
<p>Let’s see how we can apply the Oaxaca-Blinder method to our dataset</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(oaxaca)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(psych)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Salary variables are often skewed so we first log transform it to make it approximately normal</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>df_clean<span class="sc">$</span>BasePay_log <span class="ot">=</span> <span class="fu">log</span>(df_clean<span class="sc">$</span>BasePay)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Oaxaca-blinder requires to have the "grouping" variable dummified, here we have Men coded as 0 and Women coded as 1</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>df_clean<span class="sc">$</span>Gender_fac <span class="ot">=</span> <span class="fu">ifelse</span>(df_clean<span class="sc">$</span>Gender <span class="sc">==</span> <span class="st">"Male"</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>oaxaca.results <span class="ot">=</span> <span class="fu">oaxaca</span>(BasePay_log <span class="sc">~</span> Age <span class="sc">+</span> PerfEval <span class="sc">+</span> Education <span class="sc">+</span> Seniority <span class="sc">+</span> Dept <span class="sc">+</span> JobTitle <span class="sc">|</span> Gender_fac, <span class="at">data =</span> df_clean)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>AGPG <span class="ot">=</span> <span class="fu">round</span>(((oaxaca.results<span class="sc">$</span>y<span class="sc">$</span>y.A <span class="sc">-</span> oaxaca.results<span class="sc">$</span>y<span class="sc">$</span>y.B)<span class="sc">/</span>oaxaca.results<span class="sc">$</span>y<span class="sc">$</span>y.A)<span class="sc">*</span><span class="dv">100</span>,<span class="dv">2</span>)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="fu">paste0</span>(<span class="st">"The AGPG estimated through Oaxaca-Blinder = "</span>, <span class="sc">-</span><span class="dv">1</span><span class="sc">*</span>AGPG, <span class="st">"%"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "The AGPG estimated through Oaxaca-Blinder = -0.83%"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>total_explained_gap <span class="ot">=</span> <span class="fu">sum</span>(oaxaca.results<span class="sc">$</span>twofold<span class="sc">$</span>variables[[<span class="dv">1</span>]][,<span class="dv">2</span>])</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>total_explained_gap</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.08884663</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the explained contributions</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>explained_contrib <span class="ot">&lt;-</span> oaxaca.results<span class="sc">$</span>twofold<span class="sc">$</span>variables[[<span class="dv">1</span>]][,<span class="dv">2</span>]</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate each variable's percentage contribution</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>percent_contrib <span class="ot">&lt;-</span> (explained_contrib <span class="sc">/</span> total_explained_gap) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># View the results as a data frame for readability</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>percent_contrib</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                (Intercept)                         Age 
                 0.00000000                -11.03585455 
                   PerfEval        EducationHigh School 
                 0.77643006                  0.52469503 
           EducationMasters                EducationPhD 
                 2.53142337                  2.03719189 
                  Seniority             DeptEngineering 
               -10.83392467                  0.07157305 
             DeptManagement              DeptOperations 
                 0.62933742                 -0.02917396 
                  DeptSales              JobTitleDriver 
                -1.07064058                  0.50484202 
  JobTitleFinancial Analyst    JobTitleGraphic Designer 
                 0.14270967                  0.22879409 
                 JobTitleIT             JobTitleManager 
                 0.85123634                 32.44653953 
JobTitleMarketing Associate     JobTitleSales Associate 
                50.91997479                 -0.07194944 
  JobTitleSoftware Engineer JobTitleWarehouse Associate 
                31.27382534                  0.10297061 </code></pre>
</div>
</div>
</section>
<section id="ipw" class="level2">
<h2 class="anchored" data-anchor-id="ipw">IPW</h2>
<p>Limitation Oaxaca https://www.iza.org/publications/dp/981/matching-as-a-tool-to-decompose-wage-g</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>formula_ipw <span class="ot">=</span> <span class="st">'Gender_fac ~ Age + PerfEval + Education + Seniority + Dept + JobTitle'</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>weights_ipw <span class="ot">=</span> <span class="fu">glm</span>(formula_ipw,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">'probit'</span>),</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> df_clean)    </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co">#calculate ipw weights</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>ipw_w <span class="ot">=</span> <span class="fu">predict</span>(weights_ipw, df_clean, <span class="at">type =</span><span class="st">'response'</span>)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>outcome <span class="ot">=</span> df_clean<span class="sc">$</span>Gender_fac</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>df_clean<span class="sc">$</span>ipw_wts <span class="ot">=</span> (outcome<span class="sc">/</span>ipw_w) <span class="sc">+</span> ((<span class="dv">1</span><span class="sc">-</span>outcome)<span class="sc">/</span> (<span class="dv">1</span><span class="sc">-</span>ipw_w)) </span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="co"># fit with ipw weights</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>formula_lm <span class="ot">=</span> <span class="st">'BasePay_log ~ Gender_fac'</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">=</span> <span class="fu">lm</span>(formula_lm, <span class="at">data =</span> df_clean, <span class="at">weights=</span> ipw_wts)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(marginaleffects)</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>comp <span class="ot">=</span> <span class="fu">avg_comparisons</span>(mod, </span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>                       <span class="at">variables =</span> <span class="st">'Gender_fac'</span>, </span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>                       <span class="at">vcov =</span><span class="sc">~</span>subclass, </span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>                       <span class="at">newdata =</span> <span class="fu">subset</span>(df_clean, Gender_fac <span class="sc">==</span><span class="dv">1</span>), </span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>                       <span class="at">wts =</span> <span class="st">'ipw_wts'</span>)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>AGPG_ipw <span class="ot">=</span> <span class="fu">round</span>((<span class="fu">exp</span>(comp[<span class="st">'estimate'</span>])<span class="sc">-</span><span class="dv">1</span>)<span class="sc">*</span><span class="dv">100</span>,<span class="dv">2</span>)</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a><span class="fu">paste0</span>(<span class="st">"The AGPG estimated by IPW is = "</span>, AGPG_ipw, <span class="st">"%"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "The AGPG estimated by IPW is = -2.51%"</code></pre>
</div>
</div>
</section>
<section id="matching" class="level2">
<h2 class="anchored" data-anchor-id="matching">Matching</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MatchIt)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>match <span class="ot">=</span> <span class="fu">matchit</span>(<span class="fu">as.formula</span>(formula_ipw), </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">method =</span> <span class="st">'full'</span>, </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> df_clean,</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">distance =</span> <span class="st">'glm'</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking balance after cem matching</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(match, <span class="at">un =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
matchit(formula = as.formula(formula_ipw), data = df_clean, method = "full", 
    distance = "glm")

Summary of Balance for Matched Data:
                            Means Treated Means Control Std. Mean Diff.
distance                           0.5735        0.5730          0.0025
Age                               41.8291       41.4478          0.0276
PerfEval                           2.9359        3.0069         -0.0495
EducationCollege                   0.2628        0.2321          0.0698
EducationHigh School               0.2821        0.2928         -0.0239
EducationMasters                   0.2286        0.2290         -0.0008
EducationPhD                       0.2265        0.2461         -0.0469
Seniority                          3.0128        3.1115         -0.0710
DeptAdministration                 0.2030        0.3030         -0.2486
DeptEngineering                    0.1902        0.1806          0.0244
DeptManagement                     0.1859        0.1910         -0.0132
DeptOperations                     0.2051        0.1936          0.0285
DeptSales                          0.2158        0.1318          0.2042
JobTitleData Scientist             0.1132        0.1145         -0.0039
JobTitleDriver                     0.0983        0.0970          0.0043
JobTitleFinancial Analyst          0.1047        0.0959          0.0288
JobTitleGraphic Designer           0.1026        0.0929          0.0318
JobTitleIT                         0.1068        0.0902          0.0540
JobTitleManager                    0.0385        0.0385          0.0000
JobTitleMarketing Associate        0.2286        0.2286          0.0000
JobTitleSales Associate            0.0919        0.0956         -0.0127
JobTitleSoftware Engineer          0.0171        0.0171          0.0000
JobTitleWarehouse Associate        0.0983        0.1298         -0.1059
                            Var. Ratio eCDF Mean eCDF Max Std. Pair Dist.
distance                        0.9943    0.0038   0.0662          0.0108
Age                             0.9836    0.0148   0.0472          1.1090
PerfEval                        1.1398    0.0361   0.0772          0.7794
EducationCollege                     .    0.0307   0.0307          0.6546
EducationHigh School                 .    0.0108   0.0108          0.8050
EducationMasters                     .    0.0003   0.0003          0.6494
EducationPhD                         .    0.0196   0.0196          0.8220
Seniority                       1.1428    0.0408   0.0655          1.1060
DeptAdministration                   .    0.1000   0.1000          0.8102
DeptEngineering                      .    0.0096   0.0096          0.8054
DeptManagement                       .    0.0051   0.0051          0.8556
DeptOperations                       .    0.0115   0.0115          0.8417
DeptSales                            .    0.0840   0.0840          0.7275
JobTitleData Scientist               .    0.0012   0.0012          0.5031
JobTitleDriver                       .    0.0013   0.0013          0.4651
JobTitleFinancial Analyst            .    0.0088   0.0088          0.4751
JobTitleGraphic Designer             .    0.0097   0.0097          0.4057
JobTitleIT                           .    0.0167   0.0167          0.4709
JobTitleManager                      .    0.0000   0.0000          0.0000
JobTitleMarketing Associate          .    0.0000   0.0000          0.0000
JobTitleSales Associate              .    0.0037   0.0037          0.4648
JobTitleSoftware Engineer            .    0.0000   0.0000          0.0000
JobTitleWarehouse Associate          .    0.0315   0.0315          0.5309

Sample Sizes:
              Control Treated
All            532.       468
Matched (ESS)   68.76     468
Matched        532.       468
Unmatched        0.         0
Discarded        0.         0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>df_out <span class="ot">=</span> <span class="fu">match.data</span>(match)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># fit with ipw weights</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>formula_lm <span class="ot">=</span> <span class="st">'BasePay_log ~ Gender_fac'</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">=</span> <span class="fu">lm</span>(formula_lm, <span class="at">data =</span> df_out, <span class="at">weights=</span> weights)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>comp <span class="ot">=</span> <span class="fu">avg_comparisons</span>(mod, </span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>                       <span class="at">variables =</span> <span class="st">'Gender_fac'</span>, </span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>                       <span class="at">vcov =</span><span class="sc">~</span>subclass, </span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>                       <span class="at">newdata =</span> <span class="fu">subset</span>(df_out, Gender_fac <span class="sc">==</span><span class="dv">1</span>), </span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>                       <span class="at">wts =</span> <span class="st">'weights'</span>)</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>AGPG_match <span class="ot">=</span> <span class="fu">round</span>((<span class="fu">exp</span>(comp[<span class="st">'estimate'</span>])<span class="sc">-</span><span class="dv">1</span>)<span class="sc">*</span><span class="dv">100</span>,<span class="dv">2</span>)</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="fu">paste0</span>(<span class="st">"The AGPG estimated by full matching is = "</span>, AGPG_match, <span class="st">"%"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "The AGPG estimated by full matching is = -2.55%"</code></pre>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>